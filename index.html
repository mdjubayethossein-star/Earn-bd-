<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn BD 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9465942' data-sdk='show_9465942'></script>

    <style>
        :root { --main: #ff007f; --white: #ffffff; --bg: #fff0f5; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: linear-gradient(180deg, #ff007f 0%, #ff69b4 100%); color: #333; min-height: 100vh; overflow-x: hidden; }
        
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; color: white; }
        .u-info { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #fff; object-fit: cover; background: #eee; }
        .wallet-box { background: rgba(0,0,0,0.25); padding: 7px 15px; border-radius: 20px; font-weight: bold; }

        .banner-box { padding: 0 20px; margin-bottom: 15px; text-align: center; position: relative; }
        .theme-banner { width: 100%; height: 160px; border-radius: 18px; object-fit: cover; box-shadow: 0 8px 20px rgba(0,0,0,0.2); background: #fff; display: block; }
        .marquee-container { background: white; border-radius: 10px; padding: 8px 12px; margin-top: 15px; display: flex; align-items: center; gap: 10px; color: var(--main); font-weight: bold; font-size: 14px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }

        .container { background: var(--white); border-radius: 35px 35px 0 0; padding: 25px 20px; min-height: 85vh; box-shadow: 0 -10px 20px rgba(0,0,0,0.1); }
        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .menu-item { background: white; border-radius: 20px; padding: 15px 5px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.06); cursor: pointer; transition: 0.2s; border: 1px solid #f0f0f0; }
        .menu-item:active { transform: scale(0.92); }
        .icon-box { width: 42px; height: 42px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; color: white; font-size: 18px; }

        .screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 1000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .active-page { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .back-btn { font-size: 24px; color: var(--main); cursor: pointer; margin-bottom: 20px; display: inline-block; }
        .btn-action { width: 100%; padding: 15px; border-radius: 15px; border: none; background: var(--main); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }
        .card { background: var(--bg); padding: 20px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #ffdeef; }
        .list-row { display: flex; justify-content: space-between; padding: 12px; background: #fff; border-radius: 12px; margin-bottom: 8px; border: 1px solid #eee; }
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-top: 5px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="home-page">
        <div class="header">
            <div class="u-info">
                <img src="" id="home-avatar" class="avatar">
                <div><b id="home-name">Loading...</b><br><small id="home-tag">@username</small></div>
            </div>
            <div class="wallet-box">‡ß≥ <span id="main-balance">0.00</span></div>
        </div>

        <div class="banner-box">
            <img id="top-banner" class="theme-banner" src="https://img.freepik.com/free-vector/abstract-horizontal-banner-with-financial-symbols_23-2148281041.jpg">
            <div class="marquee-container">
                <i class="fas fa-bolt"></i>
                <marquee id="scroll-text">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ EARN BD 2026 ‡¶¨‡¶≠‡ßá‡•§</marquee>
            </div>
        </div>

        <div class="container">
            <div class="menu-grid">
                <div class="menu-item" onclick="nav('monetag-task')"><div class="icon-box" style="background:#7b2ff7;"><i class="fas fa-play"></i></div><small>Start Task</small></div>
                <div class="menu-item" onclick="nav('tg-task')"><div class="icon-box" style="background:#0088cc;"><i class="fab fa-telegram-plane"></i></div><small>TG Task</small></div>
                <div class="menu-item" onclick="nav('profile-sc')"><div class="icon-box" style="background:#ff4081;"><i class="fas fa-user"></i></div><small>Profile</small></div>
                <div class="menu-item" onclick="nav('top-sc')"><div class="icon-box" style="background:#ff9800;"><i class="fas fa-crown"></i></div><small>Leaderboard</small></div>
                <div class="menu-item" onclick="nav('withdraw-sc')"><div class="icon-box" style="background:#00c853;"><i class="fas fa-wallet"></i></div><small>Withdraw</small></div>
                <div class="menu-item" onclick="nav('history-sc')"><div class="icon-box" style="background:#2196f3;"><i class="fas fa-history"></i></div><small>History</small></div>
                <div class="menu-item" onclick="nav('notice-sc')"><div class="icon-box" style="background:#f44336;"><i class="fas fa-bell"></i></div><small>Notice</small></div>
                <div class="menu-item" onclick="nav('inbox-sc')"><div class="icon-box" style="background:#333;"><i class="fas fa-envelope-open-text"></i></div><small>Inbox</small></div>
                <div class="menu-item" onclick="openSupport()"><div class="icon-box" style="background:#9c27b0;"><i class="fas fa-headset"></i></div><small>Support</small></div>
                <div class="menu-item" onclick="nav('dev-sc')"><div class="icon-box" style="background:#607d8b;"><i class="fas fa-code"></i></div><small>Developer</small></div>
            </div>
        </div>
    </div>

    <div id="monetag-task" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3 style="text-align:center;">Daily Task</h3><div class="card" style="text-align:center;"><p id="reward-text" style="font-size:22px; font-weight:bold; color:var(--main);">Earn: ‡ß≥ 0.00</p><p id="ad-stat">Daily: 0 / 0</p><p id="hour-stat">Hourly: 0 / 0</p><div style="background:#ddd; height:12px; border-radius:10px; margin:15px 0; overflow:hidden;"><div id="ad-progress-bar" style="background:var(--main); height:100%; width:0%; transition:0.3s;"></div></div><button class="btn-action" id="watch-ad-btn" onclick="runAd()">WATCH AD</button><p id="timer-text" style="color:red; font-weight:bold; display:none; margin-top:10px;"></p></div></div>

    <div id="tg-task" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3>üì¢ Telegram Tasks</h3><div id="tg-list"></div></div>

    <div id="top-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3>üèÜ Top 50 Leaders</h3><div id="leader-list"></div></div>

    <div id="dev-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3 style="text-align:center;">Developer Info</h3><div class="card" style="text-align:center;"><i class="fas fa-user-shield" style="font-size:50px; color:var(--main);"></i><h2>EARN BD 2026</h2><p>Official Developer Support</p><button class="btn-action" onclick="window.open('https://t.me/earnkingadmin')">Contact Developer</button></div></div>

    <div id="profile-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><div style="text-align:center;"><img id="prof-img" src="" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--main);"><h2 id="prof-name">User</h2><div class="card"><div class="list-row"><span>Balance:</span> ‡ß≥ <span class="val-bal">0.00</span></div><div class="list-row"><span>User ID:</span> <b id="prof-id">0</b></div></div></div></div>
    <div id="withdraw-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3>Withdraw</h3><select id="w-method-list"></select><input type="number" id="w-amt" placeholder="Amount"><input type="text" id="w-num" placeholder="Account number"><button class="btn-action" onclick="doWithdraw()">WITHDRAW NOW</button></div>
    <div id="inbox-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3>üì© Inbox</h3><div id="inbox-list"></div></div>
    <div id="history-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3>History</h3><div id="history-list"></div></div>
    <div id="notice-sc" class="screen"><i class="fas fa-arrow-left back-btn" onclick="back()"></i><h3>Official Notice</h3><div class="card" id="admin-notice-sc">Loading...</div></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAAC0VHMLLTtwPZ4LGpEMCYnaM7NbAgnY0", databaseURL: "https://earn-bd-793b3-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        let balance = 0, adCount = 0, hourlyCount = 0, userId = "guest", supportLink = "";
        let adminTask = { adReward: 0.07, dailyLimit: 100, hourlyLimit: 50 };
        let vpnData = { status: 'off' };

        // ‡ßß. ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞
        db.ref('admin_settings').on('value', snap => {
            const data = snap.val();
            if(!data) return;
            if(data.theme && data.theme.banner) document.getElementById('top-banner').src = data.theme.banner;
            if(data.notice) {
                document.getElementById('scroll-text').innerText = data.notice;
                document.getElementById('admin-notice-sc').innerText = data.notice;
            }
            if(data.tasks) adminTask = data.tasks;
            if(data.vpn) vpnData = data.vpn;
            if(data.links) supportLink = data.links.support;
            
            // ‡¶Æ‡ßá‡¶•‡¶° ‡¶≤‡ßã‡¶°
            if(data.methods) {
                let h = "";
                Object.values(data.methods).forEach(m => h += `<option value="${m.name}">${m.name} (Min ‡ß≥${m.min})</option>`);
                document.getElementById('w-method-list').innerHTML = h;
            }
            updateUI();
        });

        // ‡ß®. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏
        if(tg.initDataUnsafe.user) {
            const u = tg.initDataUnsafe.user;
            userId = u.id;
            document.getElementById('home-name').innerText = u.first_name;
            document.getElementById('home-avatar').src = u.photo_url || `https://ui-avatars.com/api/?name=${u.first_name}&background=ff007f&color=fff`;
            document.getElementById('prof-id').innerText = userId;
            document.getElementById('prof-img').src = document.getElementById('home-avatar').src;

            db.ref('users/' + userId).on('value', snap => {
                const d = snap.val();
                if(d) {
                    balance = d.balance || 0;
                    adCount = d.adCount || 0;
                    hourlyCount = d.hourlyCount || 0;
                    updateUI();
                } else {
                    db.ref('users/' + userId).set({ name: u.first_name, balance: 0, adCount: 0, hourlyCount: 0 });
                }
            });

            db.ref('notifications/' + userId).on('value', snap => {
                let h = "";
                snap.forEach(c => {
                    const n = c.val();
                    h += `<div class="card"><b>${n.title}</b><p>${n.msg || n.message}</p></div>`;
                });
                document.getElementById('inbox-list').innerHTML = h || "No message";
            });
        }

        // ‡ß©. ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° (‡¶ü‡¶™ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)
        db.ref('users').orderByChild('balance').limitToLast(50).on('value', snap => {
            let arr = [];
            snap.forEach(c => arr.push(c.val()));
            arr.reverse();
            let h = "";
            arr.forEach((u, i) => {
                h += `<div class="list-row"><span>${i+1}. ${u.name}</span><b>‡ß≥${(u.balance || 0).toFixed(2)}</b></div>`;
            });
            document.getElementById('leader-list').innerHTML = h;
        });

        // ‡ß™. TG Task (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)
        db.ref('admin_settings/tg_tasks').on('value', snap => {
            let h = "";
            snap.forEach(c => {
                const t = c.val();
                h += `<div class="card"><b>${t.title} (‡ß≥${t.reward})</b><br><button class="btn-action" onclick="window.open('${t.link}')">Join Now</button></div>`;
            });
            document.getElementById('tg-list').innerHTML = h || "No Task";
        });

        // ‡ß´. ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü ‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        async function runAd() {
            if(vpnData.status === 'on') {
                try {
                    const res = await fetch('https://ipapi.co/json/');
                    const ip = await res.json();
                    if(ip.country_code !== vpnData.countryCode) {
                        return tg.showAlert(`‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶¶‡ßá‡¶∂! ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá VPN ‡¶¶‡¶ø‡ßü‡ßá ${vpnData.countryName} ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ü‡¶á‡¶™‡¶ø: ${ip.country_name}`);
                    }
                } catch(e) {}
            }

            if(adCount >= adminTask.dailyLimit) return alert("‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!");
            if(hourlyCount >= adminTask.hourlyLimit) return alert("‡¶è‡¶á ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!");

            if (typeof show_9465942 === 'function') {
                const btn = document.getElementById('watch-ad-btn');
                btn.disabled = true;
                show_9465942().then(() => {
                    db.ref('users/' + userId).update({
                        balance: balance + parseFloat(adminTask.adReward),
                        adCount: adCount + 1,
                        hourlyCount: hourlyCount + 1
                    });
                    alert("‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                    btn.disabled = false;
                });
            }
        }

        function updateUI() {
            document.getElementById('main-balance').innerText = balance.toFixed(2);
            document.querySelectorAll('.val-bal').forEach(e => e.innerText = balance.toFixed(2));
            document.getElementById('ad-stat').innerText = `Daily: ${adCount} / ${adminTask.dailyLimit}`;
            document.getElementById('hour-stat').innerText = `Hourly: ${hourlyCount} / ${adminTask.hourlyLimit}`;
            document.getElementById('reward-text').innerText = "Earn: ‡ß≥ " + parseFloat(adminTask.adReward).toFixed(2);
            let p = (adCount / adminTask.dailyLimit) * 100;
            document.getElementById('ad-progress-bar').style.width = p + "%";
        }

        function doWithdraw() {
            const amt = parseFloat(document.getElementById('w-amt').value);
            const num = document.getElementById('w-num').value;
            if(amt > balance || !num) return alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡¶ø‡¶®!");
            db.ref('withdrawals').push({ uid: userId, amount: amt, number: num, method: document.getElementById('w-method-list').value, status: 'pending' });
            db.ref('users/' + userId).update({ balance: balance - amt });
            alert("‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); back();
        }

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
        }
        function back() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-page'));
        }
        function openSupport() { window.open(supportLink || 'https://t.me/earnkingadmin'); }
    </script>
</body>
</html>